networks:
  tango-net:
    name: tango-net
    driver: bridge

services:
  tango-db:
    image: registry.gitlab.com/ska-telescope/ska-tango-images/ska-tango-images-tango-db:local
    platform: linux/x86_64
    networks:
      - tango-net
    environment:
      - MARIADB_ROOT_PASSWORD=root
      - MARIADB_DATABASE=tango
      - MARIADB_USER=tango
      - MARIADB_PASSWORD=tango
    healthcheck:
      test: ["CMD", "healthcheck.sh", "--connect"]
      start_period: 10s
      interval: 10s
      timeout: 5s
      retries: 3

  tango-dbds:
    image: registry.gitlab.com/ska-telescope/ska-tango-images/ska-tango-images-tango-databaseds:5.22.1
    platform: linux/x86_64
    networks:
      - tango-net
    ports:
      - "10000:10000"
    environment:
      - TANGO_HOST=localhost:10000
      - MYSQL_HOST=tango-db:3306
      - MYSQL_USER=tango
      - MYSQL_PASSWORD=tango
      - MYSQL_DATABASE=tango
    depends_on:
      tango-db:
        condition: service_healthy
    entrypoint: ''
    command:
      - Databaseds
      - "2"
      - -ORBendPoint
      - giop:tcp::10000
    healthcheck:
      test: ["CMD", "/usr/local/bin/tango_admin", "--ping-database"]
      start_period: 10s
      interval: 10s
      timeout: 5s
      retries: 3
